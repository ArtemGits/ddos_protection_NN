""" Generate test data to send to Kafka """

import random
from time import sleep
from json import dumps

from kafka import KafkaProducer, KafkaClient

################################################################################
# Import test data
################################################################################

#TEST_DATA = #[
    #{'id': 1, 'foo': 'bar'},
    #{'id': 2, 'foo': 'baz'},
    #{'id': 3, 'foo': 'bnat'}
#]


TEST_DATA = [
        {'id' : 1, 'frame': [('60950','80','6','22823363','2','6','3','4.242640687','0','0','0','0','0.262888515','0.087629505','22800000','0','22800000','22800000','22800000','22800000','0','22800000','22800000','0','0','0','0','0','0.087629505','0','2','3.464101615','0','0','0','0')]},
        {'id': 2, 'frame': [('60950','80','6','22823363','2','6','3','4.242640687','0','0','0','0','0.262888515','0.087629505','22800000','0','22800000','22800000','22800000','22800000','0','22800000','22800000','0','0','0','0','0','0.087629505','0','2','3.464101615','0','0','0','0')]},
        { 'id': 3, 'frame': [('60950','80','6','22823363','2','6','3','4.242640687','0','0','0','0','0.262888515','0.087629505','22800000','0','22800000','22800000','22800000','22800000','0','22800000','22800000','0','0','0','0','0','0.087629505','0','2','3.464101615','0','0','0','0')]}
]


################################################################################
# Set up producer
################################################################################

KAFKA = KafkaClient('kafka:9092')
PRODUCER = KafkaProducer(
    bootstrap_servers='kafka:9092',
    client_id='test-producer'
)

TOPIC = 'test-topic'

################################################################################
# Loop, add to kafka
################################################################################

#LOOP = True
i = 0
while i < 3:

    rown = random.randint(0, len(TEST_DATA) - 1)

    rec = TEST_DATA[rown]

    try:
        #avro_push(rec)
        PRODUCER.send(TOPIC, value=str.encode(dumps(rec)))
    except UnicodeDecodeError:
        pass

    print('pushed: %s' % rown)

    # Send records at random intervals; adjust this to send more or less frequently
    sleep(random.uniform(0.01, 5))
    i = i + 1
